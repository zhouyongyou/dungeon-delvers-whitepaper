# 5. NFT 市場與交易系統 (NFT Marketplace)

## 5.1 市場架構概覽

⚠️ **測試版本聲明**：以下市場合約地址為測試版，正式版本將在完成安全審計後更新。

DungeonDelvers 採用雙軌市場系統，滿足不同的交易需求：

### 5.1.1 即時交易市場
- **合約地址**: `0x89ea44Ed690071E13b09a5f7E73FC5ca951fb94f` *(測試版)*
- **功能定位**: 固定價格的即時買賣市場
- **支援代幣**: USDT、BUSD 及其他已授權代幣
- **上架費用**: 無（免費上架）
- **交易手續費**: 2.5%（歸項目方）

### 5.1.2 議價系統
- **合約地址**: `0xA37B1aAD17e6d3d3861E7dE88Ca36E6b2Ce3D47e` *(測試版)*
- **功能定位**: 允許買家對任意 NFT 發起報價
- **報價機制**: 支援多幣種報價，賣家可選擇接受或拒絕
- **自動過期**: 報價有效期由買家設定
- **批量操作**: 支援同時對多個 NFT 發起報價

## 5.2 市場整合狀態

### 5.2.1 子圖整合
- **統一查詢端點**: 市場數據已整合至主子圖
- **實時數據同步**: 所有交易、報價數據即時更新
- **歷史記錄追蹤**: 完整保存所有交易歷史

### 5.2.2 前端整合
- **購買模組**: 支援兩種交易模式
- **統一類型定義**: 使用 `src/types/marketplace.ts` 管理
- **動態價格顯示**: 自動轉換 BigDecimal 格式

## 5.3 交易流程

### 5.3.1 上架流程
1. 選擇要出售的 NFT（英雄/聖物/隊伍）
2. 設定價格和接受的支付代幣（USDT/BUSD）
3. 授權 NFT 給市場合約
4. NFT 轉移至市場合約託管

### 5.3.2 購買流程
1. 瀏覽市場列表或搜尋特定 NFT
2. 選擇支付方式（USDT 或 BUSD）
3. 確認交易並支付
4. NFT 自動轉移至買家

### 5.3.3 報價流程
1. 對目標 NFT 發起報價
2. 設定報價金額和有效期
3. 等待賣家響應
4. 若接受，自動完成交易

## 5.4 安全機制

### 5.4.1 託管保護
- 所有上架 NFT 由合約託管
- 防止重複出售或惡意操作
- 支援緊急下架功能

### 5.4.2 價格驗證
- 最低價格限制防止誤操作
- Oracle 價格校驗（針對 SOUL）
- 防止價格操縱攻擊

### 5.4.3 權限控制
- 只有 NFT 擁有者可以上架
- 報價接受需要賣家確認
- 管理員可暫停市場交易

## 5.5 手續費分配

### 5.5.1 交易手續費
- **費率**: 每筆交易的 2.5%
- **分配**: 100% 歸入項目金庫
- **用途**: 支持項目運營和發展

### 5.5.2 上架政策
- **上架費用**: 免費
- **目的**: 降低交易門檻，促進市場活躍
- **防濫用機制**: 通過其他方式防止惡意刷單

## 5.6 未來發展計劃

### 5.6.1 拍賣功能
- 支援限時拍賣模式
- 自動延時機制
- 最低加價幅度設定

### 5.6.2 批量交易
- 一次購買多個 NFT
- 打包出售功能
- 批量報價系統

### 5.6.3 社交功能
- 收藏夾系統
- 交易評價機制
- 賣家信譽系統